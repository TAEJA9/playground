<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeongyeon's Photo Exhibition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Noto+Serif+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #1a1a1a;
            color: #f3f4f6;
        }
        .serif {
            font-family: 'Noto Serif KR', serif;
        }
        
        .photo-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .photo-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }
        
        .guestbook-bg {
            background-image: radial-gradient(#333 1px, transparent 1px);
            background-size: 20px 20px;
            background-color: #262626;
        }
        .guestbook-container {
            height: 800px; 
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        .sticky-note {
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 2px 4px 8px rgba(0,0,0,0.3);
        }
        .sticky-note:hover {
            transform: scale(1.05) rotate(0deg) !important;
            z-index: 10;
            box-shadow: 5px 10px 15px rgba(0,0,0,0.4);
        }
        .sticky-note.pinned {
            z-index: 5;
            border: 2px solid #ff4444;
        }
        
        ::-webkit-scrollbar {
            width: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #1a1a1a; 
        }
        ::-webkit-scrollbar-thumb {
            background: #555; 
            border-radius: 5px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #777; 
        }

        /* ì ‘ì† ì œí•œ ê²Œì´íŠ¸ ìŠ¤íƒ€ì¼ */
        #access-gate {
            background-color: #000;
            background-image: url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=2072&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
        }
        #access-gate::before {
            content: '';
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.8);
        }
        
        /* ë¡œë”© ì¸ë””ì¼€ì´í„° */
        #loading {
            display: none;
        }

        /* í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .pagination-btn {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-weight: bold;
            transition: all 0.2s;
        }
        .pagination-btn.active {
            background-color: white;
            color: black;
        }
        .pagination-btn.inactive {
            background-color: #333;
            color: gray;
        }
        .pagination-btn.inactive:hover {
            background-color: #555;
            color: white;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col overflow-hidden" id="main-body">

    <!-- ì ‘ì† ì œí•œ ê²Œì´íŠ¸ -->
    <div id="access-gate" class="fixed inset-0 z-[100] flex flex-col items-center justify-center text-white px-4">
        <div class="relative z-10 text-center max-w-md w-full bg-black/60 p-8 rounded-lg border border-gray-700 backdrop-blur-md shadow-2xl">
            <h2 class="text-4xl font-bold serif mb-2 tracking-widest">PRIVATE EXHIBITION</h2>
            <p class="text-gray-400 mb-8 text-sm">ê´€ê³„ì ì™¸ ì¶œì…ê¸ˆì§€</p>
            
            <div class="space-y-4">
                <p class="text-sm font-light">ê´€ë¦¬ìì—ê²Œ ë°›ìœ¼ì‹  ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
                <input type="password" id="gate-pw" class="w-full bg-gray-800/80 border border-gray-600 rounded p-3 text-center text-white tracking-widest focus:outline-none focus:border-white transition" placeholder="PASSWORD">
                <button onclick="checkAccess()" class="w-full bg-white text-black font-bold py-3 rounded hover:bg-gray-200 transition">ì…ì¥í•˜ê¸°</button>
                <p id="gate-error" class="text-red-500 text-xs mt-2 hidden font-bold">ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
                <p id="gate-checking" class="text-blue-400 text-xs mt-2 hidden animate-pulse">í™•ì¸ ì¤‘...</p>
            </div>
        </div>
    </div>

    <!-- ë¡œë”© í‘œì‹œ -->
    <div id="loading" class="fixed top-4 right-4 z-[60] bg-blue-600 text-white px-4 py-2 rounded-full shadow-lg text-sm font-bold animate-pulse">
        <i class="fas fa-spinner fa-spin mr-2"></i> ì €ì¥ ì¤‘...
    </div>

    <!-- í—¤ë” -->
    <header class="py-12 text-center border-b border-gray-800 bg-black/30 backdrop-blur-sm sticky top-0 z-40">
        <h1 class="text-4xl md:text-5xl font-bold serif mb-2 text-white tracking-widest cursor-pointer" onclick="location.reload()">The GRAND Image Festival</h1>
        <p class="text-gray-400 text-sm md:text-base font-light">ì²œí•˜ì œì¼ ì˜¨ë¼ì¸ ì‚¬ì§„ì „</p>
    </header>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="flex-grow container mx-auto px-4 py-8">
        
        <!-- ì¹´í…Œê³ ë¦¬ íƒ­ -->
        <div class="flex justify-center gap-4 mb-12 flex-wrap" id="category-container">
            <div class="text-gray-500">ì¹´í…Œê³ ë¦¬ ë¡œë”© ì¤‘...</div>
        </div>

        <!-- ì‚¬ì§„ ê°¤ëŸ¬ë¦¬ ê·¸ë¦¬ë“œ -->
        <div id="gallery-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12 min-h-[200px]">
            <div class="col-span-full text-center text-gray-500 pt-10">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
        </div>

        <!-- í˜ì´ì§€ë„¤ì´ì…˜ ì»¨íŠ¸ë¡¤ -->
        <div id="pagination-container" class="flex justify-center gap-2 mb-20">
            <!-- í˜ì´ì§€ ë²„íŠ¼ë“¤ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
        </div>

        <hr class="border-gray-800 my-16">

        <!-- ë°©ëª…ë¡ ì„¹ì…˜ -->
        <section id="guestbook" class="mb-20">
            <div class="text-center mb-10">
                <h2 class="text-3xl serif mb-3">Guestbook</h2>
                <p class="text-gray-400">ììœ ë¡­ê²Œ ê°ìƒí‰ì„ ë‚¨ê²¨ì£¼ì„¸ìš”.</p>
            </div>

            <div class="max-w-xl mx-auto mb-12 bg-gray-800 p-6 rounded-lg shadow-lg">
                <div class="flex flex-col gap-4">
                    <input type="text" id="guest-name" placeholder="ì´ë¦„ (Name)" class="p-3 rounded bg-gray-700 border border-gray-600 text-white focus:outline-none focus:border-white transition">
                    <textarea id="guest-msg" rows="3" placeholder="ì–´ë–¤ ì‚¬ì§„ì´ ì¢‹ì•˜ë‚˜ìš”? (Message)" class="p-3 rounded bg-gray-700 border border-gray-600 text-white focus:outline-none focus:border-white transition"></textarea>
                    <button onclick="addGuestbookEntry()" class="bg-white text-black font-bold py-3 rounded hover:bg-gray-200 transition">ê²Œì‹œë¬¼ ë¶™ì´ê¸°</button>
                </div>
            </div>

            <div id="guestbook-board" class="guestbook-container guestbook-bg p-8 rounded-xl flex flex-wrap content-start gap-6 justify-center relative">
                <!-- ë°©ëª…ë¡ ë Œë”ë§ -->
            </div>
        </section>

    </main>

    <footer class="py-8 text-center text-gray-500 text-sm border-t border-gray-800 relative">
        <p>&copy; Jeongyeon. 2025</p>
        <a href="admin.html" class="absolute bottom-8 right-8 text-gray-700 hover:text-gray-400 text-xs border border-gray-800 px-2 py-1 rounded hover:border-gray-600 transition">Admin Page</a>
    </footer>

    <!-- ì´ë¯¸ì§€ í™•ëŒ€ë³´ê¸° ëª¨ë‹¬ -->
    <div id="image-modal" class="fixed inset-0 bg-black/95 z-50 hidden flex items-center justify-center opacity-0 transition-opacity duration-300">
        <button onclick="closeModal()" class="absolute top-6 right-6 text-white/70 hover:text-white text-4xl z-[60] focus:outline-none"><i class="fas fa-times"></i></button>
        <button onclick="changeImage(-1)" class="absolute left-4 top-1/2 -translate-y-1/2 text-white/50 hover:text-white text-5xl p-4 focus:outline-none z-[60] hidden md:block"><i class="fas fa-chevron-left"></i></button>
        <div class="relative max-w-[90vw] max-h-[85vh] flex flex-col items-center">
            <img id="modal-img" src="" alt="í¬ê²Œ ë³´ê¸°" class="max-w-full max-h-[80vh] object-contain shadow-2xl rounded-sm">
            <div class="mt-4 text-center">
                <h3 id="modal-title" class="text-xl font-bold text-white serif tracking-wider"></h3>
                <p id="modal-desc" class="text-gray-400 text-sm mt-1"></p>
            </div>
        </div>
        <button onclick="changeImage(1)" class="absolute right-4 top-1/2 -translate-y-1/2 text-white/50 hover:text-white text-5xl p-4 focus:outline-none z-[60] hidden md:block"><i class="fas fa-chevron-right"></i></button>
    </div>

    <script>
        // ==========================================
        // ğŸš¨ ì—¬ê¸°ì— ë°°í¬í•œ êµ¬ê¸€ ì›¹ ì•± URLì„ ê¼­ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”! (https://script.google.com/...)
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyzIX76xN4sel_Onttg_xlNrARV71H-2R5lwwPlyXlVzhs_8HeFIO044okCBtd6gU7bFQ/exec"; 
        // ==========================================

        // --- ë°ì´í„° ë° ìƒíƒœ ---
        let photos = [];
        let guestbookEntries = [];
        let categories = [];
        let currentCategory = 'all';
        const bgColors = ['bg-yellow-200', 'bg-blue-200', 'bg-green-200', 'bg-pink-200', 'bg-purple-200'];

        // --- í˜ì´ì§€ë„¤ì´ì…˜ ì„¤ì • ---
        const ITEMS_PER_PAGE = 6; // í•œ í˜ì´ì§€ë‹¹ ë³´ì—¬ì¤„ ì‚¬ì§„ ìˆ˜
        let currentPage = 1;


        // --- ì‹œí¬ë¦¿ ê²Œì´íŠ¸ (ì„œë²„ ì¸ì¦ ë°©ì‹) ---
        async function checkAccess() {
            const input = document.getElementById('gate-pw');
            const val = input.value.trim();
            const errorMsg = document.getElementById('gate-error');
            const checkingMsg = document.getElementById('gate-checking');
            const gate = document.getElementById('access-gate');
            const body = document.getElementById('main-body');

            if (!val) return;

            errorMsg.classList.add('hidden');
            checkingMsg.classList.remove('hidden');
            
            try {
                // ì„œë²„ì— ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ìš”ì²­
                const response = await fetch(WEB_APP_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action: 'verifyAccess', data: { key: val } })
                });
                const result = await response.json();

                if (result.result === 'success') {
                    gate.style.opacity = '0';
                    gate.style.transition = 'opacity 0.5s ease';
                    setTimeout(() => {
                        gate.style.display = 'none';
                        body.classList.remove('overflow-hidden');
                        loadData();
                    }, 500);
                } else {
                    throw new Error('Wrong password');
                }
            } catch (err) {
                errorMsg.classList.remove('hidden');
                input.value = '';
                input.focus();
                input.classList.add('border-red-500');
                setTimeout(() => input.classList.remove('border-red-500'), 500);
            } finally {
                checkingMsg.classList.add('hidden');
            }
        }

        document.getElementById('gate-pw').addEventListener('keypress', (e) => {
            if(e.key === 'Enter') checkAccess();
        });


        // --- API í†µì‹  í•¨ìˆ˜ ---
        async function loadData() {
            if(!WEB_APP_URL || WEB_APP_URL.includes('ì—¬ê¸°ì—')) {
                alert("HTML íŒŒì¼ ì½”ë“œ ìƒë‹¨ì˜ WEB_APP_URL ë³€ìˆ˜ì— ë°°í¬ëœ ì£¼ì†Œë¥¼ ë„£ì–´ì£¼ì„¸ìš”!");
                return;
            }

            try {
                // ìºì‹œ ë°©ì§€ìš© timestamp ì¶”ê°€
                const response = await fetch(`${WEB_APP_URL}?action=getAll&t=${new Date().getTime()}`);
                const data = await response.json();
                
                photos = data.photos || [];
                // 1. ë°ì´í„° ë¡œë“œ í›„ ëœë¤ ì„ê¸°
                shuffleArray(photos);

                guestbookEntries = data.guestbook || [];
                categories = data.categories || [];

                console.log("Loaded Data:", data);

                renderCategories();
                renderGallery(currentCategory); // í˜ì´ì§€ë„¤ì´ì…˜ ì ìš©ëœ ë Œë”ë§
                renderGuestbook();

            } catch (error) {
                console.error("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", error);
                alert("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (URLê³¼ ë°°í¬ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”)");
            }
        }

        // --- ëœë¤ ì„ê¸° ìœ í‹¸ë¦¬í‹° (Fisher-Yates Shuffle) ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        async function sendData(action, payload) {
            const loading = document.getElementById('loading');
            loading.style.display = 'block';
            
            try {
                await fetch(WEB_APP_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action: action, data: payload })
                });
            } catch (error) {
                console.error("ì „ì†¡ ì‹¤íŒ¨:", error);
                alert("ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            } finally {
                loading.style.display = 'none';
            }
        }

        // --- ìœ í‹¸ë¦¬í‹° ---
        function getDriveImage(link) {
            if (link && link.includes('drive.google.com')) {
                const idMatch = link.match(/\/d\/(.+?)\//);
                if (idMatch) return `https://lh3.googleusercontent.com/d/${idMatch[1]}=w1000`;
            }
            return link;
        }

        // --- UI ë Œë”ë§ ---

        function renderCategories() {
            const container = document.getElementById('category-container');
            let html = `<button onclick="filterGallery('all')" class="category-btn px-6 py-2 rounded-full border border-gray-600 hover:bg-white hover:text-black transition-all active bg-white text-black" data-category="all">ì „ì²´ë³´ê¸°</button>`;
            
            categories.forEach(cat => {
                html += `<button onclick="filterGallery('${cat.id}')" class="category-btn px-6 py-2 rounded-full border border-gray-600 hover:bg-white hover:text-black transition-all text-gray-300" data-category="${cat.id}">${cat.name}</button>`;
            });
            container.innerHTML = html;
            updateCategoryStyles(currentCategory);
        }

        function renderGallery(filter = 'all') {
            // 1. í•„í„°ë§
            const filteredPhotos = filter === 'all' ? photos : photos.filter(p => p.category === filter);
            
            const grid = document.getElementById('gallery-grid');
            const paginationContainer = document.getElementById('pagination-container');
            
            if(photos.length === 0) {
                grid.innerHTML = '<div class="col-span-full text-center text-gray-500 pt-10">ì‚¬ì§„ì´ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ì¶”ê°€í•´ì£¼ì„¸ìš”.<br>(ì¶”ê°€í–ˆëŠ”ë° ì•ˆ ë³´ì´ë©´ êµ¬ê¸€ ì‹œíŠ¸ì˜ í—¤ë”ê°€ id, url ë“±ìœ¼ë¡œ ì •í™•í•œì§€ í™•ì¸í•˜ì„¸ìš”)</div>';
                paginationContainer.innerHTML = '';
                return;
            }

            if (filteredPhotos.length === 0) {
                 grid.innerHTML = '<div class="col-span-full text-center text-gray-500 pt-10">ì´ ì¹´í…Œê³ ë¦¬ì—ëŠ” ì•„ì§ ì‚¬ì§„ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                 paginationContainer.innerHTML = '';
                 return;
            }

            // 2. í˜ì´ì§€ë„¤ì´ì…˜ ê³„ì‚°
            const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
            const endIndex = startIndex + ITEMS_PER_PAGE;
            const paginatedItems = filteredPhotos.slice(startIndex, endIndex);

            // 3. ê·¸ë¦¬ë“œ ë Œë”ë§ (í˜ì´ì§€ì— í•´ë‹¹í•˜ëŠ” ì•„ì´í…œë§Œ)
            grid.innerHTML = ''; 
            paginatedItems.forEach(photo => {
                const imageUrl = getDriveImage(photo.url);
                const catName = getCategoryName(photo.category);
                
                const card = document.createElement('div');
                card.className = 'photo-card bg-gray-800 rounded-lg overflow-hidden flex flex-col h-full relative';
                
                const imgTag = imageUrl ? 
                    `<img src="${imageUrl}" alt="${photo.title}" class="w-full h-full object-cover transition duration-500 group-hover:scale-110" onerror="this.src='https://via.placeholder.com/400x300?text=Image+Error'">` :
                    `<div class="w-full h-full flex items-center justify-center bg-gray-700 text-gray-500">ì´ë¯¸ì§€ ì£¼ì†Œ ì—†ìŒ</div>`;

                card.innerHTML = `
                    <div class="relative group cursor-pointer overflow-hidden aspect-[4/3]" onclick="openModal(${photo.id})">
                        ${imgTag}
                        <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition duration-300 flex items-center justify-center opacity-0 group-hover:opacity-100">
                            <span class="text-white text-lg font-light border border-white px-4 py-1 rounded-full">í¬ê²Œ ë³´ê¸°</span>
                        </div>
                    </div>
                    <div class="p-5 flex flex-col flex-grow">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="text-xl font-bold text-white serif">${photo.title || 'ì œëª© ì—†ìŒ'}</h3>
                            <button onclick="toggleLike(event, ${photo.id})" class="like-btn transition transform text-gray-400 hover:text-white focus:outline-none">
                                <i class="far fa-heart text-2xl"></i>
                            </button>
                        </div>
                        <p class="text-gray-400 text-sm mb-4 line-clamp-2 flex-grow">${photo.description || ''}</p>
                        <div class="flex justify-between items-center text-xs text-gray-500 pt-4 border-t border-gray-700 mt-auto">
                            <span class="uppercase tracking-wider">${catName}</span>
                            <span><i class="fas fa-heart mr-1"></i> <span id="like-count-${photo.id}">${photo.likes || 0}</span>ëª…ì´ ì¢‹ì•„í•¨</span>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });

            // 4. í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ ë Œë”ë§
            renderPagination(filteredPhotos.length);
            updateCategoryStyles(filter);
        }

        // í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ ê·¸ë¦¬ê¸° í•¨ìˆ˜
        function renderPagination(totalItems) {
            const container = document.getElementById('pagination-container');
            container.innerHTML = '';

            const totalPages = Math.ceil(totalItems / ITEMS_PER_PAGE);
            if (totalPages <= 1) return; // 1í˜ì´ì§€ ì´í•˜ë©´ ë²„íŠ¼ ì•ˆ ë³´ì—¬ì¤Œ

            for (let i = 1; i <= totalPages; i++) {
                const btn = document.createElement('button');
                btn.className = `pagination-btn ${i === currentPage ? 'active' : 'inactive'}`;
                btn.innerText = i;
                btn.onclick = () => {
                    currentPage = i;
                    renderGallery(currentCategory);
                    // í˜ì´ì§€ ì´ë™ ì‹œ ìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤ (ì„ íƒ ì‚¬í•­)
                    document.querySelector('main').scrollIntoView({ behavior: 'smooth' });
                };
                container.appendChild(btn);
            }
        }

        function getCategoryName(id) {
            const cat = categories.find(c => c.id === id);
            return cat ? cat.name : id;
        }

        function filterGallery(category) { 
            currentCategory = category;
            currentPage = 1; // ì¹´í…Œê³ ë¦¬ ë³€ê²½ ì‹œ 1í˜ì´ì§€ë¡œ ì´ˆê¸°í™”
            renderGallery(category); 
        }
        
        function updateCategoryStyles(activeCategory) {
            document.querySelectorAll('.category-btn').forEach(btn => {
                if(btn.dataset.category === activeCategory) {
                    btn.classList.remove('text-gray-300', 'bg-transparent');
                    btn.classList.add('bg-white', 'text-black');
                } else {
                    btn.classList.add('text-gray-300', 'bg-transparent');
                    btn.classList.remove('bg-white', 'text-black');
                }
            });
        }

        async function toggleLike(event, id) {
            event.stopPropagation();
            const btn = event.currentTarget;
            const icon = btn.querySelector('i');
            const countSpan = document.getElementById(`like-count-${id}`);
            
            if (!icon.classList.contains('fas')) {
                icon.classList.remove('far');
                icon.classList.add('fas', 'text-red-500');
                btn.classList.add('text-red-500', 'scale-110');
                countSpan.innerText = parseInt(countSpan.innerText) + 1;
                await sendData('toggleLike', { id: id, increment: 1 });
            } 
        }

        async function addGuestbookEntry() {
            const nameInput = document.getElementById('guest-name');
            const msgInput = document.getElementById('guest-msg');
            
            if (!nameInput.value.trim() || !msgInput.value.trim()) {
                alert("ì´ë¦„ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!");
                return;
            }

            const newEntry = {
                id: Date.now(),
                name: nameInput.value.trim(),
                msg: msgInput.value.trim(),
                date: new Date().toLocaleDateString(),
                pinned: false,
                rotate: Math.floor(Math.random() * 6) - 3,
                color: bgColors[Math.floor(Math.random() * bgColors.length)]
            };

            guestbookEntries.unshift(newEntry);
            renderGuestbook();
            nameInput.value = '';
            msgInput.value = '';
            await sendData('addGuestbook', newEntry);
        }

        function renderGuestbook() {
            const board = document.getElementById('guestbook-board');
            board.innerHTML = '';
            
            const sortedEntries = [...guestbookEntries].sort((a, b) => {
                const aPinned = String(a.pinned).toUpperCase() === 'TRUE';
                const bPinned = String(b.pinned).toUpperCase() === 'TRUE';
                if (aPinned && !bPinned) return -1;
                if (!aPinned && bPinned) return 1;
                return 0;
            });

            sortedEntries.forEach(entry => {
                const isPinned = String(entry.pinned).toUpperCase() === 'TRUE';
                const pinColor = isPinned ? 'text-red-500' : 'text-gray-400 hover:text-red-500';
                const borderClass = isPinned ? 'pinned' : '';
                const note = document.createElement('div');
                note.className = `sticky-note w-64 h-auto ${entry.color} text-gray-900 p-4 shadow-lg flex flex-col relative group flex-shrink-0 ${borderClass}`;
                note.style.transform = `rotate(${entry.rotate}deg)`;
                note.innerHTML = `
                    <div class="font-bold mb-2 border-b border-black border-opacity-10 pb-1 flex justify-between items-center">
                        <span>${entry.name}</span>
                        <button onclick="alert('í•€ ê³ ì •ì€ ê´€ë¦¬ìë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.')" class="${pinColor} transition-colors focus:outline-none"><i class="fas fa-thumbtack"></i></button>
                    </div>
                    <p class="text-sm flex-grow font-handwriting break-words">${entry.msg}</p>
                    <div class="text-xs text-gray-500 mt-2 text-right">${entry.date}</div>
                `;
                board.appendChild(note);
            });
        }

        let currentModalIndex = 0;
        function closeModal() {
            const modal = document.getElementById('image-modal');
            modal.classList.add('opacity-0');
            setTimeout(() => { modal.classList.add('hidden'); document.body.style.overflow = 'auto'; }, 300);
        }
        function openModal(photoId) {
            // ëª¨ë‹¬ ì—´ ë•ŒëŠ” ì „ì²´(í˜¹ì€ í•„í„°ëœ) ë¦¬ìŠ¤íŠ¸ì—ì„œ ì°¾ì•„ì•¼ í•˜ë‹ˆ ì…”í”Œëœ photos í˜¹ì€ filteredPhotos ê¸°ì¤€ìœ¼ë¡œ ë™ì‘
            // ì—¬ê¸°ì„œëŠ” í˜„ì¬ í™”ë©´ì— ë³´ì´ëŠ”(í•„í„°ë§ëœ) ì‚¬ì§„ë“¤ ê¸°ì¤€ìœ¼ë¡œ íƒìƒ‰
            const filteredPhotos = currentCategory === 'all' ? photos : photos.filter(p => p.category === currentCategory);
            
            const index = filteredPhotos.findIndex(p => p.id === photoId);
            if(index === -1) return;
            
            currentModalIndex = index;
            updateImageModalContent();
            const modal = document.getElementById('image-modal');
            modal.classList.remove('hidden');
            setTimeout(() => modal.classList.remove('opacity-0'), 10);
            document.body.style.overflow = 'hidden';
        }
        function updateImageModalContent() {
            const filteredPhotos = currentCategory === 'all' ? photos : photos.filter(p => p.category === currentCategory);
            const photo = filteredPhotos[currentModalIndex];
            document.getElementById('modal-img').src = getDriveImage(photo.url);
            document.getElementById('modal-title').innerText = photo.title;
            document.getElementById('modal-desc').innerText = photo.description;
        }
        function changeImage(dir) {
            const filteredPhotos = currentCategory === 'all' ? photos : photos.filter(p => p.category === currentCategory);
            currentModalIndex += dir;
            if (currentModalIndex >= filteredPhotos.length) currentModalIndex = 0;
            else if (currentModalIndex < 0) currentModalIndex = filteredPhotos.length - 1;
            updateImageModalContent();
        }
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeModal();
            if (!document.getElementById('image-modal').classList.contains('hidden')) {
                if (e.key === 'ArrowLeft') changeImage(-1);
                if (e.key === 'ArrowRight') changeImage(1);
            }
        });
    </script>
</body>
</html>
