<!doctype html>
<html lang="ko" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ì˜¤ëŠ˜ì˜ ë¬¸í•™ í•œ ì¡°ê° â€“ Open Library Ã— Gemini</title>
    <meta name="description" content="Open Libraryì—ì„œ ëœë¤ ë„ì„œë¥¼ ë½‘ê³ , Geminiê°€ í•œ ë¬¸ì¥ìœ¼ë¡œ ê°ì„± ìš”ì•½í•´ ì£¼ëŠ” ì¹´ë“œ." />

    <!-- Pretendard + Tailwind -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { sans: ["Pretendard", "ui-sans-serif", "system-ui"] },
            colors: {
              brand: { 600: '#0ea5e9', 700: '#0284c7' }
            },
            boxShadow: { soft: '0 10px 30px rgba(0,0,0,.08)' }
          }
        }
      }
    </script>

    <style>
      :focus-visible { outline: 3px solid rgba(14, 165, 233, .35); outline-offset: 2px; }
    </style>
  </head>
  <body class="min-h-screen bg-gradient-to-b from-white to-sky-50 text-slate-800">
    <header class="sticky top-0 z-30 backdrop-blur bg-white/70 border-b border-slate-200">
      <div class="mx-auto max-w-4xl px-4 h-14 flex items-center justify-between">
        <div class="flex items-center gap-2">
          <span class="text-2xl">ğŸ“˜</span>
          <strong class="tracking-tight">ì˜¤ëŠ˜ì˜ ë¬¸í•™ í•œ ì¡°ê°</strong>
        </div>
        <div class="text-sm text-slate-500">Open Library Ã— Gemini</div>
      </div>
    </header>

    <main class="mx-auto max-w-4xl px-4 py-8">
      <section class="rounded-2xl bg-white shadow-soft border border-slate-100 p-6">
        <div class="grid md:grid-cols-[1fr_auto] gap-4 items-start">
          <div>
            <h1 class="text-3xl font-black leading-tight">ëœë¤ ë„ì„œ + í•œ ë¬¸ì¥ ê°ì„± ìš”ì•½</h1>
            <p class="mt-2 text-slate-600">Open Libraryì—ì„œ ë„ì„œë¥¼ í•˜ë‚˜ ê³¨ë¼ì˜¤ê³ , Google Geminiê°€ ìŠ¤í¬ì¼ëŸ¬ ì—†ì´ í•œêµ­ì–´ë¡œ <em>í•œ ë¬¸ì¥</em> ê°ì„± ìš”ì•½ì„ ë§Œë“­ë‹ˆë‹¤.</p>
            <p class="mt-1 text-xs text-slate-500">â€» ë°ëª¨ ìš©ë„: ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ Gemini REST í˜¸ì¶œ. ìš´ì˜í™˜ê²½ì—ì„  í”„ë¡ì‹œ/ì„œë²„ ì‚¬ìš© ê¶Œì¥.</p>
          </div>
          <div class="flex gap-2">
            <button id="pick-btn" class="rounded-xl bg-brand-600 hover:bg-brand-700 text-white font-semibold px-5 py-3">ìƒˆë¡œ ë½‘ê¸°</button>
            <button id="share-btn" class="rounded-xl bg-slate-900/90 hover:bg-slate-900 text-white font-semibold px-4 py-3">ê³µìœ </button>
          </div>
        </div>

        <div class="mt-6 grid md:grid-cols-[140px,1fr] gap-5 items-center">
          <div class="w-full aspect-[2/3] overflow-hidden rounded-xl bg-slate-100 flex items-center justify-center" id="cover-wrap">
            <div class="text-slate-400">í‘œì§€</div>
          </div>
          <div>
            <div class="text-sm uppercase tracking-wider text-slate-500">BOOK</div>
            <h2 id="book-title" class="text-2xl font-extrabold mt-1">â€”</h2>
            <div id="book-author" class="text-slate-600 mt-1">â€”</div>
            <div id="book-year" class="text-slate-400 text-sm">â€”</div>
            <hr class="my-4" />
            <div class="text-sm uppercase tracking-wider text-slate-500">GEMINI ONE-LINER</div>
            <p id="gemini-line" class="mt-1 text-lg leading-relaxed">â€”</p>
          </div>
        </div>

        <div id="toast" class="fixed left-1/2 -translate-x-1/2 top-4 z-50 hidden"></div>
        <div id="error" class="mt-4"></div>
      </section>
    </main>

    <footer class="border-t border-slate-200 py-6 text-center text-sm text-slate-500">Â© Jeongyeon. 2025</footer><script>
  // Apps Script Web App URL (ë°°í¬ í›„ ë³µì‚¬í•´ì„œ ë¶™ì—¬ë„£ê¸°)
  const GEMINI_PROXY_URL = "https://script.google.com/macros/s/AKfycbyg8SdcldotCbrJMUaSRKzwPgmvzRMoz11CqlTiWawGpC5dzjdzu34PO4EuBbFisC8p/exec";
</script>

    <script>
      // ================= Constants =================
      const SUBJECTS = ['love','life','adventure','history','science','art','fantasy','poetry','mystery','philosophy'];
      const SUBJECT_ENDPOINT = (s,limit=50)=>`https://openlibrary.org/subjects/${encodeURIComponent(s)}.json?limit=${limit}`;
      const WORK_ENDPOINT     = (key)=>`https://openlibrary.org${key}.json`;
      const COVER_URL         = (id,size='L')=>`https://covers.openlibrary.org/b/id/${id}-${size}.jpg`;

      const GEMINI_URL = (model='gemini-1.5-flash')=>`https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${encodeURIComponent(GEMINI_API_KEY)}`;

      // ================= Helpers =================
      const qs = (s,el=document)=>el.querySelector(s);
      function toast(msg, tone='ok'){
        const el = qs('#toast');
        el.className = 'fixed left-1/2 -translate-x-1/2 top-4 z-50';
        el.innerHTML = `<div class="rounded-xl px-4 py-3 text-sm shadow-2xl border ${tone==='err'?'bg-red-50 text-red-700 border-red-200':'bg-slate-900 text-white border-slate-800'}">${msg}</div>`;
        el.style.display='block';
        setTimeout(()=>{el.style.display='none'},1800);
      }
      const setHTML = (id, html)=> qs(id).innerHTML = html;

      function setLoading(){
        setHTML('#gemini-line', '<span class="text-slate-400">í•œ ì¤„ ë§Œë“œëŠ” ì¤‘â€¦</span>');
      }

      // ================= Open Library =================
      async function pickRandomWork(){
        const subject = SUBJECTS[Math.floor(Math.random()*SUBJECTS.length)];
        const res = await fetch(SUBJECT_ENDPOINT(subject, 50));
        if(!res.ok) throw new Error('Open Library ì—°ê²° ì˜¤ë¥˜');
        const data = await res.json();
        if(!data.works || !data.works.length) throw new Error('í•´ë‹¹ ì£¼ì œì— ì‘í’ˆì´ ì—†ì–´ìš”');
        const work = data.works[Math.floor(Math.random()*data.works.length)];
        return work; // { title, authors, cover_id, key, first_publish_year }
      }

      async function loadWork(){
        qs('#error').innerHTML = '';
        const coverWrap = qs('#cover-wrap');
        coverWrap.innerHTML = '<div class="animate-pulse bg-slate-200 w-full h-full"></div>';
        setHTML('#book-title', 'â€”');
        setHTML('#book-author', 'â€”');
        setHTML('#book-year', 'â€”');
        setLoading();
        try{
          const work = await pickRandomWork();
          const title   = work.title || 'ì œëª© ë¯¸ìƒ';
          const authors = (work.authors && work.authors.map(a=>a.name).join(', ')) || 'ì‘ê°€ ë¯¸ìƒ';
          const year    = work.first_publish_year || 'ì—°ë„ ë¯¸ìƒ';
          const cover   = work.cover_id ? COVER_URL(work.cover_id, 'L') : null;

          coverWrap.innerHTML = cover ? `<img src="${cover}" alt="${title}" class="w-full h-full object-cover"/>` : '<div class="flex items-center justify-center w-full h-full text-slate-400">í‘œì§€ ì—†ìŒ</div>';
          setHTML('#book-title', title);
          setHTML('#book-author', authors);
          setHTML('#book-year', year);

          const oneLiner = await geminiOneLine({ title, authors });
          setHTML('#gemini-line', oneLiner);

          // store for share
          window.__OLXG__ = { title, authors, year, cover, oneLiner };
        }catch(err){
          qs('#error').innerHTML = `<div class="mt-3 rounded-xl bg-red-50 text-red-700 border border-red-200 px-4 py-3 text-sm">ì˜¤ë¥˜: ${err.message}</div>`;
          setHTML('#gemini-line','â€”');
          toast('ë¶ˆëŸ¬ì˜¤ê¸°ì— ì‹¤íŒ¨í–ˆì–´ìš”','err');
        }
      }

      // ================= Gemini =================
async function geminiOneLine({ title, authors }){
  const prompt = [
    'ë‹¤ìŒ ë„ì„œ ì •ë³´ë¥¼ ì°¸ê³ í•´ í•œêµ­ì–´ë¡œ 20ë‹¨ì–´ ì´ë‚´ì˜ ê°ì„±ì ì¸ í•œ ë¬¸ì¥ì„ ë§Œë“¤ì–´ ì£¼ì„¸ìš”.',
    'ìŠ¤í¬ì¼ëŸ¬ ê¸ˆì§€, ì§ì ‘ ì¸ìš© ê¸ˆì§€, ì°½ì‘í˜• ìš”ì•½ìœ¼ë¡œ ì‘ì„±í•´ ì£¼ì„¸ìš”.',
    'í†¤ì€ ì‹œì ì´ë˜ ê³¼ì¥í•˜ì§€ ë§ê³ , í•œ ë¬¸ì¥ìœ¼ë¡œë§Œ ì¶œë ¥í•˜ì„¸ìš”.',
    '',
    `ì œëª©: ${title}`,
    `ì €ì: ${authors}`
  ].join('
');

  const body = {
    model: 'gemini-1.5-flash',
    contents: [{ role: 'user', parts: [{ text: prompt }] }],
    generationConfig: { temperature: 0.9, topK: 40, topP: 0.9, maxOutputTokens: 64 }
  };

  const res = await fetch(GEMINI_PROXY_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(body)
  });
  if(!res.ok){
    const txt = await res.text();
    throw new Error('Gemini í”„ë¡ì‹œ ì˜¤ë¥˜: '+txt.slice(0,120));
  }
  const data = await res.json();
  const text = data?.candidates?.[0]?.content?.parts?.[0]?.text?.trim();
  return text || 'í•œ ë¬¸ì¥ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
}

// ================= Share =================
      async function shareCard(){
        const s = window.__OLXG__ || {}; 
        const text = `ğŸ“˜ ${s.title} â€” ${s.oneLiner || ''}`.trim();
        const shareData = { title: 'ì˜¤ëŠ˜ì˜ ë¬¸í•™ í•œ ì¡°ê°', text, url: location.href };
        try{
          if(navigator.share){ await navigator.share(shareData); }
          else {
            await navigator.clipboard.writeText(`${text}\n${location.href}`);
            toast('í…ìŠ¤íŠ¸ë¥¼ í´ë¦½ë³´ë“œì— ë³µì‚¬í–ˆì–´ìš”');
          }
        }catch(e){ toast('ê³µìœ ê°€ ì·¨ì†Œë˜ì—ˆì–´ìš”','err'); }
      }

      // ================= Wire =================
      qs('#pick-btn').addEventListener('click', loadWork);
      qs('#share-btn').addEventListener('click', shareCard);

      // Auto first load
      loadWork();
    </script>
  </body>
</html>
