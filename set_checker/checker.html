<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>YCloud ë¬¸ì œì€í–‰ íŒŒì¼ ê²€ì‚¬ê¸° (ì›¹ë²„ì „)</title>
<link rel="preconnect" href="https://cdn.jsdelivr.net" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" />
<style>
:root{--bg:#0f172a;--panel:#1f2937;--ink:#e5e7eb;--ink-dim:#94a3b8;--accent:#60a5fa;--card:#111827;--rowh:36px}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--ink);font-family:Pretendard,system-ui,Segoe UI,Roboto,sans-serif}
header{padding:20px 16px;border-bottom:1px solid #334155}
h1{font-size:20px;margin:0 0 8px}
.caption{color:var(--ink-dim)}
main{max-width:1100px;margin:0 auto;padding:20px 16px}
.panel{background:var(--panel);border:1px solid #334155;border-radius:12px;padding:16px;margin-bottom:16px}
.row{display:flex;gap:12px;flex-wrap:wrap}
.card{background:var(--card);border:1px solid #334155;border-radius:12px;padding:12px;min-width:160px}
.card .k{color:var(--ink-dim);font-size:12px}
.card .v{font-size:24px;font-weight:700;margin-top:4px}
.btn{all:unset;display:inline-flex;align-items:center;gap:8px;background:var(--accent);color:#0b1220;font-weight:700;padding:10px 14px;border-radius:10px;cursor:pointer}
.btn.secondary{background:#334155;color:#e5e7eb}
.btn:disabled{opacity:.6;cursor:not-allowed}
.field{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
input[type="text"]{flex:1;min-width:260px;padding:10px 12px;border-radius:10px;border:1px solid #334155;background:#0b1220;color:#e5e7eb}
textarea{width:100%;min-height:160px;border-radius:10px;border:1px solid #334155;background:#0b1220;color:#e5e7eb;padding:10px 12px}
.codebox{position:relative;background:#0b1220;border:1px solid #334155;border-radius:10px;padding:10px;overflow:auto}
.grid{overflow:auto;border:1px solid #334155;border-radius:12px}
.grid-sets{max-height: calc(var(--rowh)*21 + 44px)}   /* ì•½ 20í–‰ + í—¤ë” ë†’ì´ */
.grid-issues{max-height: calc(var(--rowh)*21 + 44px)}
table{width:100%;border-collapse:collapse;font-size:14px;min-width:720px}
th,td{padding:8px 12px;border-bottom:1px solid #334155;text-align:left;white-space:nowrap;line-height:var(--rowh)}
thead th{position:sticky;top:0;background:#334155;color:#e2e8f0}
footer{padding:12px 16px;color:#94a3b8;border-top:1px solid #334155;text-align:right}
code.inline{background:#0b1220;padding:2px 6px;border-radius:6px;border:1px solid #334155}
.muted{color:#94a3b8}
</style>
</head>
<body>
<header>
  <h1>ğŸ“˜ YCloud ë¬¸ì œì€í–‰ íŒŒì¼ ê²€ì‚¬ê¸° (ì›¹ë²„ì „)</h1>
  <div class="caption">HWP/HWPX ì „ìš© Â· ì‚¬ìš´ë“œ MP3/WAV Â· íŒŒì¼ëª… â€œë¶™ì—¬ë„£ê¸°â€ ê²€ì‚¬</div>
</header>

<main>
  <!-- 1) ê²½ë¡œ â†’ PowerShell ëª…ë ¹ ìƒì„± + ìë™ í´ë¦½ë³´ë“œ ë³µì‚¬ -->
  <section class="panel">
    <h3 style="margin:4px 0 12px">1) ìƒìœ„ í´ë” ê²½ë¡œ ì…ë ¥ â†’ PowerShell ëª…ë ¹ ë§Œë“¤ê¸°</h3>
    <div class="field">
      <input id="path-input" type="text" placeholder='ì˜ˆ) C:\Users\ì •ì—°\Documents\ë¬¸ì œì€í–‰' />
      <button id="btn-build" class="btn">ëª…ë ¹ ìƒì„±</button>
      <button id="btn-copy" class="btn secondary" title="ë³µì‚¬">ë³µì‚¬</button>
    </div>
    <div class="codebox" style="margin-top:10px">
      <pre id="ps-cmd" style="margin:0;white-space:pre-wrap"># ìƒë‹¨ì—ì„œ 'ëª…ë ¹ ìƒì„±'ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”.</pre>
    </div>
    <p class="muted" style="margin-top:10px">
      ğŸ’¡ ì‹¤í–‰í•˜ë©´ **íŒŒì¼ëª… ëª©ë¡ì´ ìë™ìœ¼ë¡œ í´ë¦½ë³´ë“œì— ë³µì‚¬**ë©ë‹ˆë‹¤. ì½˜ì†”ì—ì„œ ê¸ì„ í•„ìš” X.<br/>
      ìš°ì„  <code class="inline">quest / answer / sound</code>ë¥¼ ì¬ê·€ ìŠ¤ìº”í•˜ê³  ì—†ìœ¼ë©´ ìƒìœ„ í´ë”ë¥¼ ì¬ê·€ ìŠ¤ìº”í•©ë‹ˆë‹¤.
    </p>
  </section>

  <!-- 2) ë¶™ì—¬ë„£ê¸° ì…ë ¥ -->
  <section class="panel">
    <h3 style="margin:4px 0 12px">2) PowerShell ì‹¤í–‰ í›„, ì•„ë˜ì— ë¶™ì—¬ë„£ê¸°(Ctrl+V ë˜ëŠ” ë²„íŠ¼)</h3>
    <div class="field" style="margin-bottom:8px">
      <button id="btn-paste" class="btn secondary">í´ë¦½ë³´ë“œì—ì„œ ë¶™ì—¬ë„£ê¸°</button>
      <span class="muted">ë˜ëŠ” ì§ì ‘ ë¶™ì—¬ë„£ê¸°</span>
    </div>
    <textarea id="paste-area" placeholder="ì—¬ê¸°ì— íŒŒì¼ëª… ëª©ë¡ì„ ì¤„ë°”ê¿ˆìœ¼ë¡œ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.&#10;ì˜ˆ)&#10;010000_0001Q_ê°_ì¤‘.hwpx&#10;010000_0001A_ê°_ì¤‘.hwpx&#10;020000_0004M_ê°_í•˜_ynnn.mp3"></textarea>
    <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
      <button id="btn-run" class="btn">ê²€ì‚¬ ì‹œì‘ ğŸš€</button>
      <button id="btn-dl-issues" class="btn secondary" disabled>ì´ìŠˆ CSV ë‹¤ìš´ë¡œë“œ</button>
      <button id="btn-dl-sets" class="btn secondary" disabled>ì„¸íŠ¸ ìš”ì•½ CSV ë‹¤ìš´ë¡œë“œ</button>
    </div>
  </section>

  <!-- ìš”ì•½ ì¹´ë“œ -->
  <section class="row" style="margin-bottom:8px">
    <div class="card"><div class="k">ì´ íŒŒì¼</div><div class="v" id="m-total-files">-</div></div>
    <div class="card"><div class="k">ì´ ì„¸íŠ¸</div><div class="v" id="m-total-sets">-</div></div>
    <div class="card"><div class="k">ì´ìŠˆ ìˆ˜</div><div class="v" id="m-total-issues">-</div></div>
  </section>

  <!-- í…Œì´ë¸” -->
  <section class="panel">
    <h3 style="margin:0 0 10px">ğŸ§© ì„¸íŠ¸ ìš”ì•½</h3>
    <div class="grid grid-sets"><table id="tbl-sets">
      <thead><tr>
        <th>ì„¸íŠ¸ í‚¤</th><th>Qê°œìˆ˜</th><th>Aê°œìˆ˜</th><th>Mê°œìˆ˜</th>
        <th>Gê·¸ë£¹</th><th>ë“£/ë§</th><th>ìƒíƒœ</th>
      </tr></thead>
      <tbody></tbody>
    </table></div>
  </section>

  <section class="panel">
    <h3 style="margin:0 0 10px">âš ï¸ ì´ìŠˆ ìƒì„¸</h3>
    <div class="grid grid-issues"><table id="tbl-issues">
      <thead><tr>
        <th>#</th><th>ì„¸íŠ¸ í‚¤</th><th>ë¶„ë¥˜</th><th>ìƒì„¸</th>
      </tr></thead>
      <tbody></tbody>
    </table></div>
  </section>
</main>

<footer>â“’ Jeongyeon. 2025</footer>

<script>
/* -------------------- PowerShell ëª…ë ¹ ìƒì„± + ìë™ë³µì‚¬ -------------------- */
const pathInput = document.getElementById('path-input');
const btnBuild = document.getElementById('btn-build');
const btnCopy  = document.getElementById('btn-copy');
const psCmd    = document.getElementById('ps-cmd');

function buildPS() {
  const raw = (pathInput.value || '').trim();
  const template = (P) => `$P="${P}";
$t=Get-ChildItem -LiteralPath "$P\\quest","$P\\answer","$P\\sound" -Recurse -File -ErrorAction SilentlyContinue;
if(-not $t){ $t=Get-ChildItem -LiteralPath $P -Recurse -File }
$names = $t | Select-Object -ExpandProperty Name
try { $names | Set-Clipboard } catch { ($names -join "\`r\`n") | clip }
"í´ë¦½ë³´ë“œì— $($names.Count)ê°œ íŒŒì¼ëª…ì„ ë³µì‚¬í–ˆìŠµë‹ˆë‹¤."`;
  if (!raw) { psCmd.textContent = template('C:\\Users\\me\\Documents\\ë¬¸ì œì€í–‰'); return; }
  const P = raw.replaceAll('/', '\\');
  psCmd.textContent = template(P);
}
btnBuild.addEventListener('click', buildPS);
btnCopy.addEventListener('click', async () => {
  await navigator.clipboard.writeText(psCmd.textContent);
  btnCopy.textContent = "ë³µì‚¬ë¨!";
  setTimeout(()=>btnCopy.textContent="ë³µì‚¬",1200);
});
buildPS();

/* -------------------- ë¶™ì—¬ë„£ê¸°/í‘œ ë Œë” ê³µí†µ -------------------- */
const btnPaste   = document.getElementById('btn-paste');
const area       = document.getElementById('paste-area');
const btnRun     = document.getElementById('btn-run');
const btnDlIssues= document.getElementById('btn-dl-issues');
const btnDlSets  = document.getElementById('btn-dl-sets');

btnPaste.addEventListener('click', async () => {
  try { area.value = await navigator.clipboard.readText(); }
  catch(e){ alert('í´ë¦½ë³´ë“œ ì½ê¸° ì‹¤íŒ¨: ' + e); }
});

function setMetrics(totalFiles, totalSets, totalIssues) {
  document.getElementById('m-total-files').innerText  = String(totalFiles);
  document.getElementById('m-total-sets').innerText   = String(totalSets);
  document.getElementById('m-total-issues').innerText = String(totalIssues);
}

function renderTable(id, rows, cols) {
  const tbody = document.querySelector(`#${id} tbody`);
  while (tbody.firstChild) tbody.removeChild(tbody.firstChild);
  for (const r of rows) {
    const tr = document.createElement('tr');
    for (const c of cols) {
      const td = document.createElement('td');
      td.textContent = (r[c] ?? '').toString();
      tr.appendChild(td);
    }
    tbody.appendChild(tr);
  }
}

function toCSV(rows, cols) {
  const esc = s => {
    const v = String(s ?? '').replace(/"/g,'""');
    return (v.includes(',') || v.includes('"') || v.includes('\n')) ? `"${v}"` : v;
  };
  const lines = [cols.join(',')];
  for (const r of rows) lines.push(cols.map(c => esc(r[c])).join(','));
  return lines.join('\n');
}

/* -------------------- ê²€ì‚¬ ë¡œì§ (JS) -------------------- */
const VALID_QA = new Set(['.hwp','.hwpx']);
const VALID_M  = new Set(['.mp3','.wav']);
const LISTEN   = new Set(['ynnn','yynn','nynn']);
const LEADING_RE = /^(\d{6}_\d{4})([QAM])(.*)$/i;
const G_RE       = /_G(\d{2})(?:_|\.|$)/i;
const SKILL_RE   = /_([yn]{4})(?:_|\.|$)/i;

function parseName(base) {
  const m = base.match(LEADING_RE);
  if (!m) return null;
  const prefix = m[1], qa = m[2].toUpperCase(), tail = m[3];
  const g = (G_RE.exec(tail) || [])[1] || null;
  const skill = (SKILL_RE.exec(base) || [])[1]?.toLowerCase() || null;

  // === ì„¸íŠ¸í‚¤ ìƒì„± ê·œì¹™ ===
  // 1) ë§¤ì¹­ì€ skill ì œì™¸(set_key)
  // 2) í‘œì‹œìš©ì€ skill í¬í•¨(display_key)
  const baseNoExt = base.replace(/\.[^.]+$/,'');
  const afterPrefix = baseNoExt.slice((prefix + qa).length).replace(/^_/,''); // Q/A/M ì œê±° í›„ ë‚˜ë¨¸ì§€
  const setKey = `${prefix}_${afterPrefix}`       // ìš°ì„  í¬í•¨í•œ ìƒíƒœë¡œ ë§Œë“¤ê³ 
                    .replace(/_([yn]{4})$/i,'')   // ëì— skill ìˆìœ¼ë©´ ì œê±°
                    .replace(/_$/,'');            // ë§¨ë _ ì œê±°

  // í‘œì‹œìš©: skillì´ í•˜ë‚˜ë©´ _ynnn, ì—¬ëŸ¬ ê°œë©´ _(ynnn|ynyn)
  let displayKey = setKey;
  if (skill) displayKey = `${setKey}_${skill}`;

  return { prefix, qa, gnum:g, skill, set_key:setKey, display_base:displayKey };
}

function getExt(name){ const i=name.lastIndexOf('.'); return (i>=0)? name.slice(i).toLowerCase() : ''; }

function scanFromLines(lines, isLang=true){
  const names = Array.from(new Set(lines.filter(Boolean)));
  const sets = new Map(), parsed = new Map(), issues = [];

  for (const base of names){
    const info = parseName(base);
    if (!info) continue;
    parsed.set(base, info);
    const sk = info.set_key;
    if (!sets.has(sk)) sets.set(sk, {Q:new Set(),A:new Set(),M:new Set(),skills:new Set(),gnums:new Set(),files:new Set(),display_samples:[]});
    const d = sets.get(sk);
    d[info.qa].add(base); d.files.add(base);
    if (info.skill) d.skills.add(info.skill);
    if (info.gnum) d.gnums.add(info.gnum);
    if (d.display_samples.length<3) d.display_samples.push(info.display_base);
  }

  // í™•ì¥ì ê²€ì¦
  for (const [sk, d] of sets) {
    for (const qf of d.Q) if (!VALID_QA.has(getExt(qf))) issues.push({set_key:sk, category:'í™•ì¥ì ì˜¤ë¥˜', detail:`Q í™•ì¥ì ${getExt(qf)} í—ˆìš© ì•ˆ ë¨`});
    for (const af of d.A) if (!VALID_QA.has(getExt(af))) issues.push({set_key:sk, category:'í™•ì¥ì ì˜¤ë¥˜', detail:`A í™•ì¥ì ${getExt(af)} í—ˆìš© ì•ˆ ë¨`});
    for (const mf of d.M) if (!VALID_M.has(getExt(mf))) issues.push({set_key:sk, category:'í™•ì¥ì ì˜¤ë¥˜', detail:`M í™•ì¥ì ${getExt(mf)} í—ˆìš© ì•ˆ ë¨`});
  }

  const setRows = [];
  for (const [sk, d] of sets) {
    const qn=d.Q.size, an=d.A.size, mn=d.M.size;
    const gnums=[...d.gnums].sort();
    const listen = [...d.skills].some(s=>LISTEN.has(s));
    const status = new Set();

    // ì„¸íŠ¸ ë‚´ skill ë¶ˆì¼ì¹˜ â†’ ìƒíƒœ í”Œë˜ê·¸ + í‘œì‹œ í‚¤ì— (..|..) ë¶™ì—¬ì¤Œ
    let displayKey = sk;
    const skillsSorted = [...d.skills].sort();
    if (skillsSorted.length===1){
      displayKey = `${sk}_${skillsSorted[0]}`;
    } else if (skillsSorted.length>1){
      displayKey = `${sk}_(${skillsSorted.join('|')})`;
      issues.push({set_key: sk, category:'ê·œì¹™ ìœ„ë°˜', detail:`ì„¸íŠ¸ ë‚´ skill ì½”ë“œ ë¶ˆì¼ì¹˜: ${skillsSorted.join(', ')}`});
      status.add('skill ë¶ˆì¼ì¹˜');
    }

    if (gnums.length===0){
      if (qn===0){ issues.push({set_key:sk, category:'ëˆ„ë½', detail:'Q íŒŒì¼ ì—†ìŒ'}); status.add('Q ì—†ìŒ'); }
      if (an===0){ issues.push({set_key:sk, category:'ëˆ„ë½', detail:'A íŒŒì¼ ì—†ìŒ'}); status.add('A ì—†ìŒ'); }
      if (isLang && listen && mn===0){ issues.push({set_key:sk, category:'ëˆ„ë½', detail:'ë“£/ë§ì¸ë° M ì—†ìŒ'}); status.add('M ì—†ìŒ(ë“£/ë§)'); }
    } else {
      const byG = new Map();
      for (const f of d.files){
        const info = parsed.get(f); if(!info || !info.gnum) continue;
        if (!byG.has(info.gnum)) byG.set(info.gnum, {Q:new Set(),A:new Set(),M:new Set(),skills:new Set()});
        const b = byG.get(info.gnum);
        b[info.qa].add(f); if(info.skill) b.skills.add(info.skill);
      }
      for (const [g, comp] of byG){
        if (g==='00'){
          if (comp.A.size>0){ issues.push({set_key:sk, category:'ê·œì¹™ ìœ„ë°˜', detail:'G00ì—ëŠ” A íŒŒì¼ì´ ì—†ì–´ì•¼ í•¨'}); status.add('G00ì— A ì¡´ì¬'); }
          if (isLang && [...comp.skills].some(s=>LISTEN.has(s)) && comp.M.size===0){
            issues.push({set_key:sk, category:'ëˆ„ë½', detail:'G00 ë“£/ë§ì¸ë° M ì—†ìŒ'}); status.add('G00 M ì—†ìŒ(ë“£/ë§)');
          }
        } else {
          if (comp.Q.size===0){ issues.push({set_key:sk, category:'ëˆ„ë½', detail:`G${g} Q ì—†ìŒ`}); status.add(`G${g} Q ì—†ìŒ`); }
          if (comp.A.size===0){ issues.push({set_key:sk, category:'ëˆ„ë½', detail:`G${g} A ì—†ìŒ`}); status.add(`G${g} A ì—†ìŒ`); }
          if (isLang && [...comp.skills].some(s=>LISTEN.has(s)) && comp.M.size===0){
            issues.push({set_key:sk, category:'ëˆ„ë½', detail:`G${g} ë“£/ë§ì¸ë° M ì—†ìŒ`}); status.add(`G${g} M ì—†ìŒ(ë“£/ë§)`);
          }
        }
      }
    }

    setRows.push({
      set_key: sk,                             // ë‚´ë¶€ìš© ì›ë³¸ í‚¤
      set_key_display: displayKey,             // í™”ë©´ í‘œê¸°ì— skill í¬í•¨
      q_count: qn, a_count: an, m_count: mn,
      g_groups: gnums.join(','),
      listen_speak: listen ? 'Y' : 'N',
      status: status.size? [...status].sort().join('; ') : 'OK'
    });
  }

  return { summary:{ total_files:names.length, total_sets:sets.size }, sets:setRows, issues };
}

/* -------------------- ì‹¤í–‰ -------------------- */
btnRun.addEventListener('click', () => {
  const lines = area.value.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
  const res = scanFromLines(lines, true);

  setMetrics(res.summary.total_files, res.summary.total_sets, res.issues.length);

  // ì„¸íŠ¸ í‚¤ëŠ” í‘œì‹œìš© ì»¬ëŸ¼ìœ¼ë¡œ êµì²´
  const setCols = ['set_key_display','q_count','a_count','m_count','g_groups','listen_speak','status'];
  renderTable('tbl-sets', res.sets, setCols);

  const issueRows = res.issues.map((it,i)=>({ '#': i+1, ...it }));
  renderTable('tbl-issues', issueRows, ['#','set_key','category','detail']);

  btnDlIssues.disabled = false;
  btnDlSets.disabled = false;

  btnDlIssues.onclick = () => {
    const csv = toCSV(res.issues, ['set_key','category','detail']);
    const a = document.createElement('a');
    a.href = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv);
    a.download = 'issues.csv'; a.click();
  };
  btnDlSets.onclick = () => {
    const csv = toCSV(res.sets, setCols);
    const a = document.createElement('a');
    a.href = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv);
    a.download = 'sets_summary.csv'; a.click();
  };
});
</script>
</body>
</html>